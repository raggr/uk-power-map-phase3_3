<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UK Government Power Map — All MPs</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;500;600;700;800&display=swap');
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Source Sans 3','Segoe UI',system-ui,sans-serif;background:#f0f2f5;color:#1a1a2e;min-height:100vh}
  .top-bar{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;flex-wrap:wrap;gap:8px;background:#fff;border-bottom:2px solid #e2e4e9;box-shadow:0 2px 8px rgba(0,0,0,0.06);position:sticky;top:0;z-index:100}
  .top-left h1{font-size:20px;font-weight:800;letter-spacing:-0.3px}
  .top-left .sub{font-size:10px;color:#5a6577;margin-top:1px}
  .nav-links{display:flex;gap:6px;align-items:center}
  .nav-link{font-size:12px;color:#1d70b8;text-decoration:none;font-weight:600;padding:6px 14px;border-radius:6px;transition:all 0.15s;border:1px solid transparent}
  .nav-link:hover{background:#f0f2f5;border-color:#d1d5db}
  .nav-link.active{background:#1a1a2e;color:#fff;border-color:#1a1a2e}
  .container{max-width:1200px;margin:0 auto;padding:16px 20px}
  .controls{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
  .search-input{flex:1;min-width:200px;padding:10px 14px;border:1px solid #d1d5db;border-radius:8px;font-size:13px;outline:none;background:#fff;font-family:inherit}
  .search-input:focus{border-color:#1a1a2e;box-shadow:0 0 0 2px rgba(26,26,46,0.08)}
  .sort-btn{padding:6px 14px;border:1px solid #d1d5db;border-radius:6px;font-size:11px;font-weight:600;background:#fff;cursor:pointer;color:#555;font-family:inherit;transition:all 0.15s;white-space:nowrap}
  .sort-btn:hover{background:#f5f6f8}
  .sort-btn.active{background:#1a1a2e;color:#fff;border-color:#1a1a2e}
  .summary-bar{background:#fff;border:1px solid #e2e4e9;border-radius:8px;padding:12px 16px;margin-bottom:16px;display:flex;gap:16px;flex-wrap:wrap;font-size:12px;color:#5a6577}
  .summary-bar strong{color:#1a1a2e}
  .party-section{margin-bottom:20px}
  .party-header{display:flex;align-items:center;gap:10px;padding:10px 16px;border-radius:8px 8px 0 0;color:#fff;cursor:pointer;user-select:none}
  .party-header:hover{filter:brightness(1.05)}
  .party-name{font-size:15px;font-weight:700}
  .party-count{font-size:11px;opacity:0.8;background:rgba(255,255,255,0.2);padding:2px 8px;border-radius:10px}
  .party-arrow{font-size:14px;margin-left:auto;transition:transform 0.2s}
  .party-arrow.open{transform:rotate(180deg)}
  .mp-table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e2e4e9;border-top:none;border-radius:0 0 8px 8px;overflow:hidden;display:none}
  .mp-table.open{display:table}
  .mp-table th{background:#f8f9fa;padding:6px 10px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:#5a6577;text-align:left;border-bottom:1px solid #e2e4e9;position:sticky;top:0;cursor:pointer}
  .mp-table th:hover{background:#eef0f3}
  .mp-table td{padding:7px 10px;font-size:11.5px;border-bottom:1px solid #f0f2f5;vertical-align:middle}
  .mp-table tr:hover{background:#f8f9fc}
  .mp-name{font-weight:600;color:#1a1a2e}
  .mp-name a{color:inherit;text-decoration:none}
  .mp-name a:hover{text-decoration:underline;color:#1d70b8}
  .mp-constituency{color:#5a6577}
  .mp-gender{display:inline-block;width:16px;text-align:center;font-size:11px}
  .tag{display:inline-block;font-size:8.5px;font-weight:700;padding:1px 5px;border-radius:3px;letter-spacing:0.3px}
  .tag-cosmo{background:#dbeafe;color:#1e40af}
  .tag-grad{background:#bfdbfe;color:#1d4ed8}
  .tag-necess{background:#fef3c7;color:#92400e}
  .tag-idcon{background:#fde8e8;color:#991b1b}
  .tag-trad{background:#fce7f3;color:#9d174d}
  .tag-mixed{background:#f3f4f6;color:#6b7280}
  .tag-minister{background:#d4edda;color:#155724}
  .bar-wrap{display:flex;align-items:center;gap:4px}
  .mini-bar{height:4px;border-radius:2px;background:#e5e7eb;width:60px;flex-shrink:0}
  .mini-bar-fill{height:100%;border-radius:2px}
  .val{font-size:10px;color:#8a94a6;min-width:28px}
  .majority-safe{color:#065f46}.majority-marginal{color:#b45309}.majority-vulnerable{color:#991b1b;font-weight:600}
  .loading{text-align:center;padding:60px 20px;color:#5a6577}
  .loading .spinner{width:32px;height:32px;border:3px solid #e2e4e9;border-top-color:#1a1a2e;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 16px}
  @keyframes spin{to{transform:rotate(360deg)}}
  @media(max-width:800px){.mp-table td,.mp-table th{padding:5px 6px;font-size:10px}.container{padding:10px}}
</style>
</head>
<body>
<div class="top-bar">
  <div class="top-left">
    <h1>All 650 MPs</h1>
    <div class="sub">By party affiliation &middot; Constituency profiles from Census 2021 &middot; GE2024 &middot; IMD 2019</div>
  </div>
  <div class="nav-links">
    <a class="nav-link" href="../index.html">&#9776; Power Map</a>
    <a class="nav-link" href="../maps/index.html">&#9881; Maps</a>
    <a class="nav-link active" href="#">&#128101; All MPs</a>
    <a class="nav-link" href="../guide/index.html">&#128214; Analysis Guide</a>
  </div>
</div>
<div class="container" id="app">
  <div class="loading"><div class="spinner"></div>Loading MP data…</div>
</div>
<script>
var mapData=null;
var openParties=new Set(['Labour','Conservative']);
var searchTerm='';
var sortCol='constituency';
var sortAsc=true;

var PARTY_COLORS={'Labour':'#e4003b','Labour/Co-operative':'#e4003b','Conservative':'#0087dc','Liberal Democrat':'#faa61a','Reform UK':'#12b6cf','Green':'#6ab023','Scottish National Party':'#fff95d','Plaid Cymru':'#005b54','Sinn F\u00e9in':'#326760','DUP':'#d46a4c','Social Democratic and Labour Party':'#2aa82c','Alliance':'#f6cb2f','Traditional Unionist Voice':'#0c3a6a','UUP':'#48a5ee','Independent':'#999','Speaker':'#666','Your Party':'#999'};
var PARTY_SHORT={'Labour':'Lab','Labour/Co-operative':'Lab/Co-op','Conservative':'Con','Liberal Democrat':'LD','Reform UK':'Reform','Green':'Green','Scottish National Party':'SNP','Plaid Cymru':'PC','Sinn F\u00e9in':'SF','DUP':'DUP','Social Democratic and Labour Party':'SDLP','Alliance':'APNI','Traditional Unionist Voice':'TUV','UUP':'UUP','Independent':'Ind','Speaker':'Spk','Your Party':'YP'};
var PARTY_ORDER=['Labour','Conservative','Liberal Democrat','Reform UK','Green','Scottish National Party','Plaid Cymru','Independent','Sinn F\u00e9in','DUP','Social Democratic and Labour Party','Alliance','Traditional Unionist Voice','UUP','Speaker','Your Party'];
var IDL_TAG={cosmo_core:['Cosmo Core','tag-cosmo'],cosmo_grad:['Grad Cosmo','tag-grad'],necessity:['Necessity Lib','tag-necess'],id_conservative:['ID Conservative','tag-idcon'],trad_working:['Trad Working','tag-trad'],mixed:['Mixed','tag-mixed']};

function partyColor(p){return PARTY_COLORS[p]||'#999'}
function majClass(m){if(m<2)return'majority-vulnerable';if(m<6)return'majority-marginal';return'majority-safe'}

function getAllMPs(){
  if(!mapData)return[];
  var mps=[];
  Object.keys(mapData).forEach(function(cd){
    var d=mapData[cd];
    mps.push({
      cd:cd,name:d.mp,constituency:d.name,party:d.party,gender:d.gen,
      nw:d.nw,deg:d.deg,nq:d.nq,ruk:d.ruk,mj:d.mj,lv:d.lv,
      idtype:d.idtype,imd_score:d.imd_score,imd_q:d.imd_q,
      minister:d.minister,div_chg:d.div_chg,volatility:d.volatility,
      ils:d.ils,ta_zone:d.ta_zone
    });
  });
  return mps;
}

function sortMPs(mps,col,asc){
  var dir=asc?1:-1;
  return mps.sort(function(a,b){
    var va=a[col],vb=b[col];
    if(va==null&&vb==null)return 0;
    if(va==null)return 1;if(vb==null)return-1;
    if(typeof va==='string')return dir*va.localeCompare(vb);
    return dir*(va-vb);
  });
}

function toggleParty(p){if(openParties.has(p))openParties.delete(p);else openParties.add(p);render()}
function onSearch(v){searchTerm=v.toLowerCase();render()}
function setSort(col){if(sortCol===col)sortAsc=!sortAsc;else{sortCol=col;sortAsc=col==='constituency'||col==='name'}render()}

function render(){
  var allMPs=getAllMPs();
  var filtered=searchTerm?allMPs.filter(function(m){return m.name.toLowerCase().includes(searchTerm)||m.constituency.toLowerCase().includes(searchTerm)||m.party.toLowerCase().includes(searchTerm)}):allMPs;

  // Group by party (merge Labour/Co-operative into Labour)
  var byParty={};
  filtered.forEach(function(m){
    var p=m.party;
    if(p==='Labour/Co-operative')p='Labour';
    if(!byParty[p])byParty[p]=[];
    byParty[p].push(m);
  });

  // Summary stats
  var totalF=filtered.filter(function(m){return m.gender==='F'}).length;
  var avgDeg=filtered.filter(function(m){return m.deg!=null});
  var avgDegVal=avgDeg.length?avgDeg.reduce(function(s,m){return s+m.deg},0)/avgDeg.length:0;
  var ministers=filtered.filter(function(m){return m.minister}).length;

  var h='';
  h+='<div class="controls"><input class="search-input" type="text" placeholder="Search MPs, constituencies, or parties\u2026" value="'+searchTerm+'" oninput="onSearch(this.value)">';
  h+='<button class="sort-btn'+(sortCol==='name'?' active':'')+'" onclick="setSort(\'name\')">Sort: Name</button>';
  h+='<button class="sort-btn'+(sortCol==='constituency'?' active':'')+'" onclick="setSort(\'constituency\')">Sort: Constituency</button>';
  h+='<button class="sort-btn'+(sortCol==='mj'?' active':'')+'" onclick="setSort(\'mj\')">Sort: Majority</button>';
  h+='<button class="sort-btn'+(sortCol==='deg'?' active':'')+'" onclick="setSort(\'deg\')">Sort: Graduates</button>';
  h+='<button class="sort-btn'+(sortCol==='nw'?' active':'')+'" onclick="setSort(\'nw\')">Sort: Diversity</button>';
  h+='<button class="sort-btn'+(sortCol==='ruk'?' active':'')+'" onclick="setSort(\'ruk\')">Sort: Reform</button>';
  h+='</div>';

  h+='<div class="summary-bar"><span><strong>'+filtered.length+'</strong> MPs shown</span><span><strong>'+totalF+'</strong> female ('+Math.round(totalF/filtered.length*100)+'%)</span><span>Avg graduates: <strong>'+avgDegVal.toFixed(1)+'%</strong></span><span><strong>'+ministers+'</strong> ministers</span><span>'+Object.keys(byParty).length+' parties</span></div>';

  PARTY_ORDER.forEach(function(p){
    var mps=byParty[p];
    if(!mps||!mps.length)return;
    var isOpen=openParties.has(p)||searchTerm.length>0;
    mps=sortMPs(mps,sortCol,sortAsc);
    var col=partyColor(p);
    var textCol=(p==='Scottish National Party'||p==='Alliance')?'#1a1a2e':'#fff';

    h+='<div class="party-section">';
    h+='<div class="party-header" style="background:'+col+';color:'+textCol+'" onclick="toggleParty(\''+p+'\')">';
    h+='<span class="party-name">'+p+'</span><span class="party-count">'+mps.length+' MPs</span>';
    h+='<span class="party-arrow'+(isOpen?' open':'')+'">&#9662;</span></div>';

    h+='<table class="mp-table'+(isOpen?' open':'')+'">';
    h+='<thead><tr>';
    h+='<th onclick="setSort(\'name\')">MP'+(sortCol==='name'?(sortAsc?' \u25b2':' \u25bc'):'')+'</th>';
    h+='<th onclick="setSort(\'constituency\')">Constituency'+(sortCol==='constituency'?(sortAsc?' \u25b2':' \u25bc'):'')+'</th>';
    h+='<th>Gen</th>';
    h+='<th onclick="setSort(\'mj\')">Maj%'+(sortCol==='mj'?(sortAsc?' \u25b2':' \u25bc'):'')+'</th>';
    h+='<th onclick="setSort(\'deg\')">Grads%'+(sortCol==='deg'?(sortAsc?' \u25b2':' \u25bc'):'')+'</th>';
    h+='<th onclick="setSort(\'nw\')">Non-Wh%'+(sortCol==='nw'?(sortAsc?' \u25b2':' \u25bc'):'')+'</th>';
    h+='<th onclick="setSort(\'ruk\')">Reform%'+(sortCol==='ruk'?(sortAsc?' \u25b2':' \u25bc'):'')+'</th>';
    h+='<th>Type</th>';
    h+='<th>Depriv</th>';
    h+='<th>Notes</th>';
    h+='</tr></thead><tbody>';

    mps.forEach(function(m){
      var idTag=m.idtype&&IDL_TAG[m.idtype]?'<span class="tag '+IDL_TAG[m.idtype][1]+'">'+IDL_TAG[m.idtype][0]+'</span>':'';
      var minTag=m.minister?'<span class="tag tag-minister">'+m.minister.rank+' \u00b7 '+m.minister.dept+'</span>':'';
      var depQ=m.imd_q!=null?'Q'+m.imd_q:'';
      var threat=m.ta_zone&&m.ta_zone!=='none'?' <span style="color:#dc2626;font-size:9px">\u26a0</span>':'';

      h+='<tr>';
      h+='<td class="mp-name">'+m.name+'</td>';
      h+='<td class="mp-constituency">'+m.constituency+'</td>';
      h+='<td class="mp-gender">'+(m.gender==='F'?'\u2640':'\u2642')+'</td>';
      h+='<td><span class="'+majClass(m.mj)+'">'+m.mj+'%</span></td>';
      h+='<td>'+(m.deg!=null?'<div class="bar-wrap"><div class="mini-bar"><div class="mini-bar-fill" style="width:'+Math.min(100,m.deg*1.5)+'%;background:#3b82f6"></div></div><span class="val">'+m.deg+'</span></div>':'—')+'</td>';
      h+='<td>'+(m.nw!=null?'<div class="bar-wrap"><div class="mini-bar"><div class="mini-bar-fill" style="width:'+Math.min(100,m.nw*1.2)+'%;background:#f59e0b"></div></div><span class="val">'+m.nw.toFixed(0)+'</span></div>':'—')+'</td>';
      h+='<td>'+(m.ruk!=null&&m.ruk>0?'<div class="bar-wrap"><div class="mini-bar"><div class="mini-bar-fill" style="width:'+Math.min(100,m.ruk*2.2)+'%;background:#12b6cf"></div></div><span class="val">'+m.ruk+'</span></div>':'—')+'</td>';
      h+='<td>'+idTag+threat+'</td>';
      h+='<td>'+depQ+'</td>';
      h+='<td>'+minTag+'</td>';
      h+='</tr>';
    });
    h+='</tbody></table></div>';
  });

  h+='<div style="text-align:center;font-size:10px;color:#8a94a6;padding:16px;border-top:1px solid #e2e4e9;margin-top:16px">Data: House of Commons Library (GE2024), ONS Census 2021, IMD 2019, GOV.UK. Notional 2019: Rallings & Thrasher. Identity types: Brexitland framework (Sobolewska & Ford 2020). Not audited.</div>';

  document.getElementById('app').innerHTML=h;
}

fetch('../assets/map-data.json').then(function(r){return r.json()}).then(function(data){
  mapData=data;
  render();
}).catch(function(err){
  document.getElementById('app').innerHTML='<div class="loading" style="color:#991b1b"><h3>Failed to load data</h3><p>'+err.message+'</p></div>';
});
</script>
</body>
</html>
